+function(n){n.upload=function(t){var i=n.extend({url:null,accept:null,multiple:null,success:null,progress:null,data:""},t||{}),r,u;n("#__upload").remove();r=n('<form id="__upload"><\/form>').appendTo(document.body);u=n('<input type="file" name="__uploadFile" accept="'+(i.accept||"")+'" '+(i.multiple?'multiple="multiple"':"")+' style="display:none;" />').appendTo(r).on("change",function(){var t=new FormData(r[0]);i.data.split("&").forEach(function(n){var i=n.indexOf("=");i!=-1&&t.append(n.substr(0,i),n.substr(i+1))});n.ajax({type:"post",url:i.url,data:t,contentType:!1,processData:!1,success:i.success,error:function(){alert("上传失败，可能原因：\n1.跨域问题\n2.上传的文件太大\n3.上传接口地址错误")},xhr:function(){var t=n.ajaxSettings.xhr();return i.progress&&t.upload.addEventListener("progress",function(n){i.progress(Math.floor(100*n.loaded/n.total))},!1),t}})});u.click()}}(jQuery)+function(n){function t(n,t){t&&t.split("|").forEach(function(t){n.append('<a href="'+t+'" target="_blank"><img src="'+t+'" /><span class="upload-img-remove"><\/span><\/a>')})}function i(t){var u=n("#"+t.attr("boxId")),i="",r;u.children().each(function(){i+="|"+n(this).attr("href")});i=i.substr(1);t.attr("data",i);r=t.attr("hiddenId");r&&n("#"+r).val(i)}n(".upload-img").each(function(){var i=n(this),f=i.attr("data"),e="imgBox"+Math.floor(Math.random()*1e6),o,r,u;i.attr("boxId",e);o=n('<div class="upload-img-box" id="'+e+'"><\/div>').insertBefore(i);r=i.attr("hidden-name");r&&(u="hidden"+Math.floor(Math.random()*1e6),i.attr("hiddenId",u),n('<input type="hidden" name="'+r+'" id="'+u+'" value="'+f+'"  />').insertBefore(i));t(o,f)});n(document).on("click",".upload-img",function(){var r=n(this);n.upload({url:r.attr("url"),accept:r.attr("accept")||"image/gif,image/jpeg,image/jpg,image/png,image/svg",multiple:r.attr("multiple"),data:r.attr("upload-param"),success:function(u){var f=n("#"+r.attr("boxId"));r.attr("multiple")||f.empty();t(f,u);i(r)}})});n(document).on("click",".upload-img-remove",function(t){t.preventDefault();var r=n(this),u=n(".upload-img[boxId="+r.closest(".upload-img-box").attr("id")+"]");r.closest("a").remove();i(u)})}(jQuery);